<!-- demo/web_app/static/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>ProtoGCN 운동 인식 데모</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        video { border: 2px solid #333; }
        .status { padding: 15px; background: #f0f0f0; margin: 10px 0; }
        .progress { width: 100%; height: 30px; background: #ddd; }
        .progress-bar { height: 100%; background: #4CAF50; transition: width 0.3s; }
    </style>
</head>
<body>
    <div class="container">
        <h1>운동 자세 인식 데모 (ProtoGCN)</h1>
        
        <video id="video" width="640" height="480" autoplay></video>
        
        <div class="status">
            <h3>상태</h3>
            <p>프레임: <span id="frame-count">0</span>/100</p>
            <div class="progress">
                <div class="progress-bar" id="progress" style="width: 0%"></div>
            </div>
            
            <div id="result" style="margin-top: 20px; display: none;">
                <h3>인식 결과</h3>
                <p>동작: <span id="action"></span></p>
                <p>신뢰도: <span id="confidence"></span></p>
            </div>
        </div>
    </div>
    
    <script>
        const video = document.getElementById('video');
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        
        navigator.mediaDevices.getUserMedia({video: true})
            .then(stream => video.srcObject = stream);
        
        const ws = new WebSocket('ws://localhost:8000/ws');
        
        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            
            document.getElementById('frame-count').innerText = data.frame_count;
            document.getElementById('progress').style.width = data.frame_count + '%';
            
            if (data.status === 'predicted' && data.prediction) {
                document.getElementById('result').style.display = 'block';
                document.getElementById('action').innerText = data.prediction.class;
                document.getElementById('confidence').innerText = 
                    (data.prediction.confidence * 100).toFixed(1) + '%';
            }
        };
        
        setInterval(() => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            canvas.toBlob(blob => {
                const reader = new FileReader();
                reader.onloadend = () => ws.send(reader.result);
                reader.readAsDataURL(blob);
            }, 'image/jpeg');
        }, 100);
    </script>
</body>
</html>